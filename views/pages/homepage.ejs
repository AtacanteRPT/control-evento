<main>
    <div class="row">
        <div class="col s12">
            <div style="padding: 35px;" align="center" class="card">
                <div class="row">
                    <div class="left card-title">
                        <b>Controlar Asistencia</b>
                    </div>
                </div>


 

                <!--<div class="row">
                    <a href="#!">
                        <div style="padding: 30px;" class="grey lighten-3 col s5 waves-effect">
                            <i class="indigo-text text-lighten-1 large material-icons">person</i>
                            <span class="indigo-text text-lighten-1"><h5>Seller</h5></span>
                        </div>
                    </a>
                    <div class="col s1">&nbsp;</div>
                    <div class="col s1">&nbsp;</div>

                    <a href="#!">
                        <div style="padding: 30px;" class="grey lighten-3 col s5 waves-effect">
                            <i class="indigo-text text-lighten-1 large material-icons">people</i>
                            <span class="indigo-text text-lighten-1"><h5>Customer</h5></span>
                        </div>
                    </a>
                </div>-->



                <div class="row">
                    <div class="col s12">
                        <div class="row">
                            <div class="input-field col s12">
                                <i class="material-icons prefix">search</i>
                                <input type="text" id="inputBuscar" class="autocomplete">
                                <label for="inputBuscar">Buscar a militante</label>
                            </div>
                        </div>
                    </div>
                </div>



                <table class="striped" id="tablaMilitantes">
                    <thead>
                        <tr>
                            <th>Nro</th>
                            <th>Nombre</th>
                            <th>Cargo</th>
                            <th>Cedula</th>
                            <th>Celular</th>
                            <th>Asistencia</th>
                            <th>Editar</th>
                        </tr>
                    </thead>

                    <tbody>
                        <!--<tr>
                            <td>0</td>
                            <td>ToPa</td>
                            <td>Ricardo</td>
                            <td>707052</td>
                            <td>

                                <div class="switch">
                                    <label>
                                    NO
                                    <input type="checkbox">
                                    <span class="lever"></span>
                                    SI
                                  </label>
                                </div>
                            </td>
                        </tr>-->

                    </tbody>
                </table>
            </div>
        </div>


    </div>


    <div class="fixed-action-btn click-to-toggle" style="bottom: 45px; right: 24px;">
        <a class="btn-floating btn-large pink waves-effect waves-light">
            <i class="large material-icons">add</i>
        </a>

        <ul>
            <li>
                <a class="btn-floating red"><i class="material-icons">note_add</i></a>
                <a href="" class="btn-floating fab-tip">Adicionar Militante</a>
            </li>
        </ul>
    </div>
</main>



 <!-- Modal Structure -->
 <div id="modal1" class="modal">
    <div class="modal-content">
      <h4>Actualizar Información</h4>
      
      <div class="row">
        <form method="POST" action="/controlador/actualizarMilitante" class="col s12">
        <input id="inputId" type="number" name="id" hidden=true class="validate">
          <div class="row">
            <div class="input-field col s6">
              <i class="material-icons prefix">account_circle</i>
              <input id="inputNombre" type="text" name="nombre" class="validate">
              <label for="icon_prefix">Nombre</label>
            </div>
            <div class="input-field col s6">
              <i class="material-icons prefix">card_membership</i>
              <input id="inputCedula" type="tel" name="cedula" class="validate">
              <label for="icon_telephone">Cedula</label>
            </div>
            <div class="input-field col s6">
                <i class="material-icons prefix">phone</i>
                <input id="inputCelular" type="number" name="celular" class="validate">
                <label for="icon_prefix">Celular</label>
              </div>
              <div class="input-field col s6">
                <i class="material-icons prefix">location_on</i>
                <input id="inputDireccion" type="tel" name="direccion" class="validate">
                <label for="icon_telephone">Dirección</label>
              </div>
          </div>

          <!-- <input type="submit" value="Actualizar"> -->
          <button class="btn waves-effect waves-light" type="submit" name="action">Actualizar
                <i class="material-icons right">send</i>
              </button>
        </form>
      </div>
    </div>
    <div class="modal-footer">

    </div>
  </div>

<script>
    $('.button-collapse').sideNav();

    $('.collapsible').collapsible();

    $('select').material_select();


    var auxMilitantes = <%- JSON.stringify(militantes) %>

        // var votosTrue = auxMilitantes.filter(auxVoto => auxVoto.voto == true);
        // var auxAsistencias = votosTrue.length;
        function actualizarTabla(listaMilitantes) {
            $('#tablaMilitantes > tbody').empty()
            listaMilitantes.forEach(function (militante, index) {
                $('#tablaMilitantes > tbody').append('<tr id="tr' + militante.id + '">' +
                    '<td>' + (index + 1) + '</td>' +
                    '<td>' + militante.nombre + '</td>' +
                    '<td>' + militante.cargo + '</td>' +
                    '<td>' + militante.cedula + '</td>' +
                    '<td>' + militante.celular + '</td>' +
                    '<td>' + '<div class="switch"><label>NO<input id="voto' + militante.id + '" type="checkbox"><span class="lever"></span>SI</label></div>' + '</td>' +
                    '<td>' + '<button class="waves-effect waves-light btn" onclick="actualizarMilitante('+militante.id+')" type="button"><i class="material-icons">edit</i></button>' + '</td>' +
                    '</tr>')
                $('#voto' + militante.id).attr('checked', militante.asistencia)
                $('#voto' + militante.id).click(function () {
                    console.log($('#voto' + militante.id).prop('checked'))

                })
            }, this);
        }


        
        function actualizarMilitante(idMilitante){
            console.log(idMilitante)

            var militante = auxMilitantes.filter(dato=>dato.id ==idMilitante)
            var linea = $('#tr'+idMilitante).find('td')
            console.log('LINEA:',linea)

            $('#inputId').val(idMilitante)

            $('#inputNombre').val(militante[0].nombre)
            $('#inputCedula').val(militante[0].cedula)
            $('#inputCelular').val(militante[0].celular)
            $('#inputDireccion').val(militante[0].direccion)

            $('.modal').openModal();
        };
        
        
        actualizarTabla(auxMilitantes);
        $('#inputBuscar').keyup(function (event) {
        var auxBuscar = $('#inputBuscar').val()

        console.log('AUXBUSCAR:', auxBuscar)
        // $.post("/controlador/buscarMilitante", { nombre: auxBuscar })
        // .done(function( data ) {
        //     console.log(data)
        // });
        $.ajax({
            type: "POST",
            url: "controlador/buscarMilitante",
            data: { nombre: auxBuscar },
            dataType: "json",
            success: function (response) {
                //if request if made successfully then the response represent the data
                console.log(response)
                actualizarTabla(response)
            }
        });


    })

</script>